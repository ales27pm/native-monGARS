name: ðŸ”§ Debug Complete Workflow

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  NODE_VERSION: '18'

jobs:
  debug:
    name: ðŸ”§ Debug Complete Workflow
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ðŸ” Complete project validation
        run: |
          echo "âœ… Validating complete project structure..."
          
          # Check if key files exist
          if [ -f "App.tsx" ]; then
            echo "âœ… App.tsx exists"
          else
            echo "âŒ App.tsx missing"
            exit 1
          fi
          
          if [ -f "package.json" ]; then
            echo "âœ… package.json exists"
          else
            echo "âŒ package.json missing"
            exit 1
          fi
          
          if [ -d "src" ]; then
            echo "âœ… src directory exists"
          else
            echo "âŒ src directory missing"
            exit 1
          fi
          
          # Check key directories
          if [ -d "src/screens" ]; then
            echo "âœ… src/screens directory exists"
          else
            echo "âŒ src/screens directory missing"
            exit 1
          fi
          
          if [ -d "src/services" ]; then
            echo "âœ… src/services directory exists"
          else
            echo "âŒ src/services directory missing"
            exit 1
          fi
          
          if [ -d "src/hooks" ]; then
            echo "âœ… src/hooks directory exists"
          else
            echo "âŒ src/hooks directory missing"
            exit 1
          fi
          
          if [ -d "src/navigation" ]; then
            echo "âœ… src/navigation directory exists"
          else
            echo "âŒ src/navigation directory missing"
            exit 1
          fi
          
          # Check for additional directories
          if [ -d "src/api" ]; then
            echo "âœ… src/api directory exists"
          else
            echo "âŒ src/api directory missing"
            exit 1
          fi
          
          if [ -d "src/state" ]; then
            echo "âœ… src/state directory exists"
          else
            echo "âŒ src/state directory missing"
            exit 1
          fi
          
          if [ -d "src/utils" ]; then
            echo "âœ… src/utils directory exists"
          else
            echo "âŒ src/utils directory missing"
            exit 1
          fi
          
          if [ -d "src/types" ]; then
            echo "âœ… src/types directory exists"
          else
            echo "âŒ src/types directory missing"
            exit 1
          fi
          
          echo "ðŸŽ‰ Complete project validation passed!"
      
      - name: ðŸ” Service architecture validation
        run: |
          echo "ðŸ” Checking service architecture..."
          
          # Check for specific service files
          services=("llm" "rag" "agent" "audio" "tools")
          for service in "${services[@]}"; do
            if [ -d "src/services/$service" ]; then
              echo "âœ… $service service directory exists"
            else
              echo "âŒ $service service directory missing"
              exit 1
            fi
          done
          
          echo "âœ… Service architecture validation passed!"
      
      - name: ðŸ” File count validation
        run: |
          echo "ðŸ” Checking file counts..."
          
          # Check TypeScript files
          ts_count=$(find src -name "*.ts" -o -name "*.tsx" 2>/dev/null | wc -l)
          echo "ðŸ“‹ TypeScript files: $ts_count"
          if [ "$ts_count" -ge 10 ]; then
            echo "âœ… TypeScript files count OK"
          else
            echo "âŒ Expected at least 10 TypeScript files, found $ts_count"
            exit 1
          fi
          
          # Check screen files
          screen_count=$(find src/screens -name "*.tsx" -o -name "*.ts" 2>/dev/null | wc -l)
          echo "ðŸ“‹ Screen files: $screen_count"
          if [ "$screen_count" -ge 5 ]; then
            echo "âœ… Screen files count OK"
          else
            echo "âŒ Expected at least 5 screen files, found $screen_count"
            exit 1
          fi
          
          # Check service files
          service_count=$(find src/services -name "*.ts" -o -name "*.tsx" 2>/dev/null | wc -l)
          echo "ðŸ“‹ Service files: $service_count"
          if [ "$service_count" -ge 5 ]; then
            echo "âœ… Service files count OK"
          else
            echo "âŒ Expected at least 5 service files, found $service_count"
            exit 1
          fi
          
          echo "âœ… File count validation passed!"
      
      - name: ðŸŽ‰ Debug success
        run: |
          echo "## ðŸŽ‰ Debug Workflow Success" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… All validations passed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Project Structure**: All 8 directories validated" >> $GITHUB_STEP_SUMMARY
          echo "- **Service Architecture**: All 5 service directories validated" >> $GITHUB_STEP_SUMMARY
          echo "- **File Counts**: TypeScript, Screen, and Service files validated" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ¯ **Ready for full workflow deployment!**" >> $GITHUB_STEP_SUMMARY
          
          echo "âœ… DEBUG WORKFLOW SUCCESS!"